
var defaultConfig = {
	myoptions: {
		"faceshop":false,
		"efimerka":false,
		"armory":true,
		"unpaused":true,
		"info":true,
		"zk":true,
		"glamurstupki":true,
		"bodestate":true,
		"sidzoku":true,
		"spdressroom":true,
		"nickhistory":true,
		"resources_prices":true,
		"okcount":true,
		"cemetry":true,
		"sledopit":true,
		"numfight":true,
		"numcapcha":true,
		"kbdinst":true,
		"chatsectors":true,
		"dragon_time":true,
		"location_info":true,
		"block_cmenu":true,
		"tab_refresh":true,
		"esc_move":true,
		"fastex":true,
		"kbdunderground":true,
		"lotereya":true,
		"estatenamelink":true,
		"forumgoto":true,
		"aliensmy":true,
		"clnick":true,
		"keyenter":true,
		"keyalt":true,
		"questsectors":true,
		"userlistactiveitems": true,
		"damaged_items_notification_filter": true,
		"clickable_nicks_on_clan_tournament": true,
		"stockmy":true,
		"taverna_filters":true,
		"map_trace":true,
		"startup_update_notification":true,
		"global_info": true,
		"trade_buy_full_lot": true,
		"contextmenus": true,
		"teammate_trace": false,
		"taverna_fast_click": true,
		"timer_taverna": true,
		"timer_jeweler": true,
		"timer_estate": true,
		"timer_pet": true,
		"timer_egg": true,
		"stock_sell_offline_find": true,
		"clickablePSmiles" : true,
		'clickbaleNamesInGlobalEventReports' : true,
		'estateVictims': true,
		'battleInfo': true,
		'menu_maps': true,
		'battleCounter': true,
		'lottery_zk': true,
		'repeat_kudes': true,
		'monster_locations': true,
		'no_flash': true,
		'buttons_holder': false,
		'kt_in_battle': false,
		'ok_hide_corpses': true,
		'biggest_buttons': false,
		'freeze_chat': true,
		'abil_heal': false,
		'sounds_on_off': true,
		'battle_move': false,
		'oplot_button': true,
		'forum_pages': true,
		'clan_ct_buttons': true,
		'inventory': true,
		'golosovalka': true,
		'snow': true,
		'sanctions': true,
		'no_block_browser_keys': true,
		'chatLightMessage': false,
		'chatOtherUsersMessageColor': false,
		'filterEmptyJailNotfication': false,
		'okHelpMessageFilterEnabled': false,
		'filterOneTeamIsStrongerMessage': false,
		'filterBattleIsClosedMessage': false,
		'filterRingOfRendomMessage': false,
		'filterGoldenHorseShoeMessage' : false,
		'filterEliteTournamentMessage' : false,
		'CTFilterEnabled': false,
		'sp_extendable_shutup' : false,
		'sp_context_shutup' : false,
		'sp_context_private_file': false,
		'sp_context_warn': false,
		'sp_context_link': false,
		'sp_chat_shut_up': false,
		'sp_shut_up_panel_background_color': false,
        'sp_shut_up_panel_links_giver': false,
        'trade_flooder_active': false,
        'alternative_chat_send': false,
        'forum_ignore': true,
        'sets_autowear': false,
        'trade_bookmarks':true,
        'location_bot_info':true,
        'expedition_estate':true,
        'underground_map':true,
        'turquoise_grid': true,
        'turquoise_info':true,
        'estate_services': true,
        'teleport': false,
        'pressedEnter': false,
        'presents2016': true,
        'fisherEnabled': false
        
	},
	
	systemOptions: {
		"background_scripts_host": "gosov.net/murlemur",
		"trace_img_src": "",
		"locatioons_ovl": "",
		"locatioons_opp": "",
		"custom_sounds": "",
		"estateVictims" : {
			"popupPositionX" : -1,
			"popupPositionY" : -1
		},
        "forumIgnore": {
            "popupPositionX" : -1,
            "popupPositionY" : -1
        },
		"okHelpMessageMinLevel" : 10,
		"minCTtime" : 9,
		"maxCTtime" : 24,
		"sledopit_index": 1,
		"chatBgColor" : "#00FF7F",
		"chatMsgColor" : "#000000",
		"shutUpBgColor" : "#d7d7d7",
		"sp_shut_up_links": "",
		"sp_qreas_time_map": 
			"0:3,6;" +
			"1:3,6;" + 
			"2:6,18;" +
			"3:6,36;" +
			"4:1,3;" + 
			"5:6,18,36,72,144;" +
			"6:144;" + 
			"7:6,18,36,72,144;" + 
			"8:144;" +
			"9:144;" + 
			"10:36,72;" +
			"11:1,3;" +
			"12:1,3;" + 
			"13:6,18;" + 
			"14:144;" +
			"15:144;" +
			"16:72,144;" +
			"17:72,144;" +
			"18:144;" +
			"19:72,144;" +
			"20:72,144;" +
			"21:36,72;" + 
			"23:144;",
        "sp_shut_up_warnings":
            "Флуд|4.1.1 Флуд. Не флудите пожалуйста!;" +
            "Флуд смайлами|4.1.1 Флуд. Не флудите смайлами!;" +
            "Реклама боя|4.1.1 Флуд. Реклама боя не чаще 1 раза в 3 минуты!;" +
            "Благо|4.1.1 Флуд. Просьба о благословении допустима не чаще 1 раза в 3 минуты!;" +
            "Капс|4.1.2 Капс. Не пишите ЗАГЛАВНЫМИ буквами!; " +
            "Создание конфликта|4.1.3 Создание конфликта, провокация и/или подстрекательство к нарушению законов проекта!;" +
            "Обсуждение СП и администрации|4.1.4 Обсуждение Администрации проекта или СП, помеха в работе!;" +
            "Попрошайничество |4.1.5 Попрошайничество. Не попрошайничайте!;" +
            "Реклама наставничества|4.4.3 Реклама услуг наставника/поиска наставника. Реклама наставничества допустима не чаще 1 раза в 10 минут!;" +
            "Поиск наставника|4.4.3 Реклама услуг наставника/поиска наставника. Поиск наставника допустим не чаще 1 раза в 10 минут!;" +
            "Поиск рефералов|4.4.3 Реклама услуг наставника/поиска наставника. Поиск рефералов допустим только в торговом чате!;" +
            "Реклама товаров|4.4.4 Реклама вне торгового чата. Реклама товаров допустима только в торговом чате!;" +
            "Реклама клана|4.4.4 Реклама вне торгового чата. Реклама набора в клан допустима только в торговом чате!;" +
            "Реклама клан-сайтов|4.4.4 Реклама вне торгового чата. Реклама клан-сайтов допустима только в торговом чате!;" +
            "Поиск товаров|4.4.4 Реклама вне торгового чата. Поиск товаров допустим только в торговом чате!;" +
            "Реклама платного блага|4.4.4 Реклама вне торгового чата. Реклама платного благословения допустима только в торговом чате!;" +
            "Поиск платного блага|4.4.4 Реклама вне торгового чата. Поиск платного благословения допустим только в торговом чате!;" +
            "Реклама шахты|4.4.4 Реклама вне торгового чата. Реклама клановой шахты допустима только в торговом чате!;" +
            "Реклама услуг|4.4.4 Реклама вне торгового чата. Реклама профессиональных услуг допустима только в торговом чате!;" +
            "Поиск услуг|4.4.4 Реклама вне торгового чата. Поиск профессиональных услуг допустим только в торговом чате!",
		"trade_flooder_phrases": "",
        "forum_ignore_user_replace": "glad"
	},

	soundOptions: {
		"sound_elitka": {
			sound: "nosound",
			detect: "Вас вызвали на арену Элитных Турниров! Есть"
		},
		"sound_event": {
			sound: "nosound",
			detect: "Началось случайное событие <b>"
		},
		"sound_kt": {
			sound: "nosound",
			detect: "Сражаются: <img width="
		},
		"sound_aliens": {
			sound: "nosound",
			detect: "Добро пожаловать на остров! Вы можете координировать"
		},
		"sound_fishing": {
			sound: "nosound",
			detect: "У вас закончилась приманка!"
		},
		"sound_tool_broken": {
			sound: "nosound",
			detect: "текущая прочность инструмента: <b>0</b>"
		},
		"sound_full_wagon": {
			sound: "nosound",
			detect: "Т.л.жка п.р.груж.на!"
		},
		"sound_full_weight": {
			sound: "nosound",
			detect: "Вы п.р.груж.ны"
		},
		"sound_user_injury" : {
			sound: "nosound",
			detect: "Персонаж .+ травмирован"	
		},
		"sound_random_event": {
			sound: "nosound",
			detect: ""
		},
		"sound_zavod": {
			sound: "nosound",
			detect: ""
		},
		"sound_taverna": {
			sound: "nosound",
			detect: ""
		},
		"sound_jeweler": {
			sound: "nosound",
			detect: ""
		},
		"sound_item_broken": {
			sound: "nosound",
			detect: "Вещи сломались"
		},
		"sound_caving": {
			sound: "nosound",
			detect: "Сейсмопредупреждение"
		},
		"sound_vnezap": {
			sound: "nosound",
			detect: "Внезапный удар"
		}	,
		"sound_heal": {
			sound: "nosound",
			detect: "Воодушевление"
		},
		"sound_25": {
			sound: "nosound",
			detect: ""
		},
		"sound_50": {
			sound: "nosound",
			detect: ""
		},
		"sound_75": {
			sound: "nosound",
			detect: ""
		},
		"sound_100": {
			sound: "nosound",
			detect: ""
		},
		"sound_attack_to" : {
			sound: "nosound",
			detect: "атакован монстрами на секторе"	
		},
		"sound_boat" : {
			sound: "nosound",
			detect: "Вы переместились на .+ потрачено"	
		},
        "sound_battle_skip_turn": {
            sound: "nosound",
            detect: ""
        }
	},
	estateVictims: {},
    forumIgnore: {},
    trade_bookmarks: {}
}

function mergeOptions(options, defaultOptions) {
	if (options === null) {
		return defaultOptions;
	}

	for (key in options) {
		defaultOptions[key] = options[key];
	}
	
	return defaultOptions;
}

function xpath(query, object) {
	if(!object) var object = document;
	return object.evaluate(query, object, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
}

var trans=[];
var snart=[];
for (var i = 0x410; i <= 0x44F; i++) {
	trans[i] = i - 0x350;
	snart[i-0x350] = i;
}
trans[0x401]= 0xA8;
trans[0x451]= 0xB8;
snart[0xA8] = 0x401;
snart[0xB8] = 0x451;

CP1251urlencode = function(str) {
	var ret=[];
	for(var i=0;i<str.length;i++) {
		var n=str.charCodeAt(i);
		if(typeof trans[n]!='undefined') {
			n = trans[n];
		}
		
		if (n <= 0xFF) {
			ret.push(n);
		}
	}

	return escape(String.fromCharCode.apply(null,ret));
}

function inject_global(script_src) {
	var scr = document.createElement("script");
	scr.text = script_src;
	document.body.appendChild(scr);
}

getStringifyParams = function(str) {
	var mas = str.match(/(.*)$/gm);
	var result = "";
	for (var i = 0; i < mas.length; i++) {
		if (mas[i] != "") result += mas[i] + "\"+\n\"";
	};
return result;
}


var toolsClass = function() {
	var self = this;
	
	this.loadOptions = function(options, callback) {
        var loadedOptions = {};

        for (i in options) {
            var extOptions = kango.storage.getItem(options[i].systemName);

            loadedOptions[options[i].systemName] =
                JSON.parse(JSON.stringify(mergeOptions(extOptions, defaultConfig[options[i].defaultName])));
        }

        callback(loadedOptions);
	};
}

var tools = new toolsClass();
